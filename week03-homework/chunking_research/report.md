# 作业1

> 为了方便描述与代码编写，代码过程放在了[main.ipynb](main.ipynb) 文件中

## 文本数据集

* [doc1.txt](docs/txt/doc1.txt)
* [doc2.txt](docs/txt/doc2.txt)
* [doc3.txt](docs/txt/doc3.txt)

## 比较不同参数组合对**检索相关性**和**生成回答质量**的影响

* 检索到的上下文是否包含答案
* LLM 生成的回答是否准确完整
* 上下文冗余程度（主观评分 1–5）
* 制作对比表格或图表展示结果。

### 代码执行结果（[main.ipynb](main.ipynb)）

```plaintext
=================分块器: sentence_splitter1(chunk_size=64, chunk_overlap=24)=================
查询: 为什么说算法偏见问题同样不容忽视？
回答: 因为AI系统通过学习历史数据做出预测和决策，如果这些数据包含社会偏见，系统可能会放大这些偏见，从而导致不公平或歧视性结果。

=================分块器: sentence_splitter1(chunk_size=128, chunk_overlap=24)=================
查询: 为什么说算法偏见问题同样不容忽视？
回答: 因为AI系统在学习历史数据时可能继承并放大其中的社会偏见，导致在招聘、贷款审批、司法判决等关键领域对特定群体产生系统性歧视。这种偏见常以“客观”和“数据驱动”的形式呈现，具有较强的隐蔽性，使人难以察觉和质疑，因此不容忽视。

=================分块器: sentence_splitter2(chunk_size=512, chunk_overlap=24)=================
查询: 为什么说算法偏见问题同样不容忽视？
回答: 算法偏见问题不容忽视，因为AI系统通过学习历史数据进行决策，而这些数据中可能包含社会固有的偏见。如果不对这些偏见进行识别和纠正，AI系统不仅会继承，还可能放大这些偏见，导致在招聘、贷款审批、司法判决等关键领域出现对特定群体的系统性歧视。更严重的是，这种偏见常以“客观”和“数据驱动”的形式呈现，使得其影响更具隐蔽性，难以被察觉和质疑。因此，解决算法偏见需要结合技术手段与对数据来源及社会结构的深入审视。

=================分块器: sentence_splitter1(chunk_size=128, chunk_overlap=0)=================
查询: 量子计算的前景光明，表现在哪些方面？
回答: 量子计算的前景光明，表现在随着技术的成熟和规模化，未来可能普及量子计算服务，甚至出现个人量子设备。同时，量子互联网的构想正在推进，有望利用量子纠缠实现安全通信和分布式量子计算。此外，美国国家标准与技术研究院（NIST）正主导制定后量子密码标准，推动信息安全升级，而量子密钥分发（QKD）等技术也为安全通信提供了新的手段。

=================分块器: sentence_splitter2(chunk_size=128, chunk_overlap=16)=================
查询: 量子计算的前景光明，表现在哪些方面？
回答: 量子计算的前景光明，表现在技术不断成熟和规模化发展，可能推动量子计算服务的普及，并催生个人量子设备。同时，量子互联网的构想正在推进，有望利用量子纠缠实现安全通信和分布式量子计算。此外，美国国家标准与技术研究院（NIST）正主导后量子密码标准的制定，预计未来几年将发布相关标准，而量子密钥分发（QKD）等技术也为安全通信提供了新的解决方案。

=================分块器: sentence_splitter2(chunk_size=128, chunk_overlap=32)=================
查询: 量子计算的前景光明，表现在哪些方面？
回答: 量子计算的前景光明，表现在其有望在材料设计、药物发现、金融建模和气候模拟等领域带来革命性突破。同时，随着技术成熟和规模化，量子计算服务可能普及，甚至出现个人量子设备。此外，量子互联网的构想正在探索中，未来可实现安全通信和分布式量子计算。

=================分块器: sentence_splitter2(chunk_size=128, chunk_overlap=64)=================
查询: 量子计算的前景光明，表现在哪些方面？
回答: 量子计算的前景光明，表现在其有望在材料设计、药物发现、金融建模、气候模拟等领域带来革命性突破。同时，相关安全技术如量子密钥分发（QKD）为通信安全提供了新的手段，进一步推动了该领域的发展。

=================分块器: Sentence=================
查询: 为什么说《巴黎协定》代表了全球气候治理的重要里程碑？
回答: 《巴黎协定》确立了将全球平均温度上升控制在工业化前水平以上远低于2°C，并努力限制在1.5°C以内的长期目标，同时强调减缓和适应气候变化的协同作用，为全球应对气候危机提供了共同框架，因此被视为全球气候治理的重要里程碑。

=================分块器: Token=================
查询: 为什么说《巴黎协定》代表了全球气候治理的重要里程碑？
回答: 《巴黎协定》确立了将全球平均温度上升控制在工业化前水平以上远低于2°C，并努力限制在1.5°C以内的长期目标，强调减缓与适应气候变化的协同作用，为全球应对气候危机提供了共同框架和行动方向。

=================分块器: Sentence Window=================
查询: 为什么说《巴黎协定》代表了全球气候治理的重要里程碑？
回答: 《巴黎协定》确立了将全球平均温度上升控制在工业化前水平以上远低于2°C，并努力限制在1.5°C以内的长期目标，标志着全球在应对气候变化方面达成了广泛共识。该协定要求所有缔约方提交国家自主贡献（NDCs），明确各自的气候行动方案，体现了自下而上的参与机制和普遍的责任分担。这一框架首次将发达国家和发展中国家纳入共同但有区别的责任体系，推动了全球范围内的减排承诺与合作。此外，《巴黎协定》还强化了透明度、报告和审评机制，为国际社会监督和提升气候行动提供了制度基础。因此，它被视为全球气候治理进程中的关键突破。
```

### 对比结果总结

| 参数组合                                                 | 上下文包含答案 | 回答是否准确完整   | 上下文冗余程度（主观评分 1-5） |
| -------------------------------------------------------- | -------------- | ------------------ | ------------------------------ |
| sentence_splitter1(chunk_size=64, chunk_overlap=24)      | 是             | 基本准确但较简略   | 2                              |
| sentence_splitter1(chunk_size=128, chunk_overlap=24)     | 是             | 准确且较完整       | 3                              |
| sentence_splitter2(chunk_size=512, chunk_overlap=24)     | 是             | 非常准确完整       | 4                              |
| sentence_splitter1(chunk_size=128, chunk_overlap=0)      | 是             | 基本准确但不够全面 | 2                              |
| sentence_splitter2(chunk_size=128, chunk_overlap=16)     | 是             | 准确但细节有限     | 3                              |
| sentence_splitter2(chunk_size=128, chunk_overlap=32)     | 是             | 准确且全面         | 3                              |
| sentence_splitter2(chunk_size=128, chunk_overlap=64)     | 是             | 基本准确但较简略   | 4                              |
| Sentence (chunk_size=128, chunk_overlap=32)              | 是             | 准确但不够详细     | 3                              |
| Token (chunk_size=128, chunk_overlap=32, separator="。") | 是             | 准确但简洁         | 3                              |
| Sentence Window (window_size=3)                          | 是             | 非常准确且极其详细 | 2                              |

### 分析总结

总体而言，Sentence Window 分块器配合适当的窗口大小在检索相关性和回答质量上表现最佳，是本次实验中推荐的分块策略。

| 影响因素                     | 具体观察                                                                                                                                        |
| ---------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------- |
| **chunk_size 影响**    | 随着 chunk_size 增大（64→128→512），回答的准确性和完整性逐步提高。<br />较大的 chunk_size 能保留更多上下文信息，使回答更全面。                |
| **chunk_overlap 影响** | 适度的 overlap（如 32）有助于提高回答质量。<br />过高的 overlap（如 64）可能导致信息冗余但回答反而不够全面。                                    |
| **分块器类型影响**     | Sentence Window 分块器表现最佳，能提供最详细准确的回答。<br />Sentence 和 Token 分块器效果相近，但 Sentence Window 凭借窗口上下文优势更胜一筹。 |
| **冗余度评估**         | 较小的 chunk_size 冗余度较低，但可能导致回答不完整。<br />Sentence Window 在保持低冗余度的同时提供了最详细的回答，显示出其优势。                |

## 哪些参数显著影响效果？为什么？

1. **chunk_size（分块大小）**：
   * 影响最显著，较大的 chunk_size（如512）能保留更多完整的上下文信息，使LLM生成的回答更全面准确
   * 较小的 chunk_size（如64）虽然检索更精确，但可能导致关键信息被分割，回答不够完整
   * 原因：chunk_size直接决定了单个向量片段包含的信息量和语义完整性，足够大的 chunk_size 才能保留完整的概念和论证
2. **分块器类型**：
   * Sentence Window分块器表现最佳，回答最详细准确
   * 普通 Sentence 和 Token 分块器效果相近，但不如 Sentence Window
   * 原因：Sentence Window 通过窗口机制既保留了句子级别的精确检索，又能在生成回答时引入上下文窗口，提供更丰富的语义背景
3. **chunk_overlap（重叠大小）**：
   * 对回答质量有明显影响，但不如 chunk_size 和分块器类型显著
   * **适当的重叠**有助于保持文本的连贯性和上下文的完整性

## chunk_overlap 过大或过小的利弊

| chunk_overlap设置 | 利                                                                                           | 弊                                                                                                                                             |
| ----------------- | -------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------- |
| **过小**    | 减少文本冗余，提高检索效率<br />分块边界更清晰，有助于精确检索特定信息                       | 可能切断相关概念之间的联系导致语义不连贯<br />重要信息可能被分割到不同的块中，影响回答质量<br />对于需要上下文理解的复杂问题，回答可能不够全面 |
| **过大**    | 确保相关信息不会被分割，保持较好的语义连贯性<br />对于跨多个句子的概念，能更好地保留其完整性 | 增加了文本冗余，可能导致检索效率下降<br />可能引入不相关信息，影响检索的精确性 会增加存储和计算开销                                            |

## 如何在“精确检索”与“上下文丰富性”之间权衡

1. **根据应用场景选择**：
   * 对于需要精确事实性回答的场景（如问答系统），优先保证检索精确性，可以选择较小的chunk_size和适度的overlap
   * 对于需要综合理解和推理的场景（如文档摘要、复杂问题解答），优先考虑上下文丰富性，选择较大的chunk_size或使用Sentence Window分块器
2. **利用Sentence Window分块器**：
   * 这是本次实验中发现的最佳平衡点
   * 它在检索阶段使用精确的句子级向量，但在生成回答时会引入更大的上下文窗口
   * 既能保证检索的精确性，又能提供丰富的上下文信息
3. **动态调整策略**：
   * 根据问题类型动态调整参数：简单问题用较小chunk_size，复杂问题用较大chunk_size
   * 结合检索结果质量评估，自动调整参数组合
4. **采用混合检索策略**：
   * 结合向量检索和全文检索的优势
   * 先通过向量检索获取相关候选，再通过全文检索筛选最相关的上下文
5. **考虑计算资源限制**：
   * 在资源有限的情况下，需要在检索精度和计算效率之间找到平衡
   * 通常，适度的chunk_size（128-256）和 overlap（20%-30%）能提供较好的平衡

通过以上策略，可以根据具体需求和约束条件，在精确检索和上下文丰富性之间找到最优平衡点。
